{"metadata":{},"options":{"plugins":[{"key":"base$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"base$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$2","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$3","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":true}},{"key":"base$0$4","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$8","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"base$0$9","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$10","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/chunwei/Documents/Lab/CrowdLearning/crowd_server/server/main.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","jsx",["flow",{}],["flow",{}],"objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties","classPrivateProperties"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"server/main.js","filename":"/home/chunwei/Documents/Lab/CrowdLearning/crowd_server/server/main.js","passPerPreset":false,"envName":"development","cwd":"/home/chunwei/Documents/Lab/CrowdLearning/crowd_server","root":"/home/chunwei/Documents/Lab/CrowdLearning/crowd_server","presets":[],"generatorOpts":{"filename":"/home/chunwei/Documents/Lab/CrowdLearning/crowd_server/server/main.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"server/main.js"}},"code":"let Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nmodule.watch(require(\"./dataScheme.js\"));\nMeteor.startup(() => {\n  const MAXTOPTIP = 2;\n  const MAXNEWTIP = 1;\n  const MAXTYPETOPTIP = 3;\n\n  function shuffle(tmparray) {\n    let currentIndex = tmparray.length,\n        temporaryValue,\n        randomIndex; // While there remain elements to shuffle...\n\n    while (0 !== currentIndex) {\n      // Pick a remaining element...\n      randomIndex = Math.floor(Math.random() * currentIndex);\n      currentIndex -= 1; // And swap it with the current element.\n\n      temporaryValue = tmparray[currentIndex];\n      tmparray[currentIndex] = tmparray[randomIndex];\n      tmparray[randomIndex] = temporaryValue;\n    }\n\n    return tmparray;\n  }\n\n  function guessHITType(id, title, description, requester) {\n    let tipsByID = Tips.find({\n      hit_set_id: id\n    }).fetch();\n    let type = \"\";\n    let typeArray = [];\n\n    if (tipsByID.length > 0) {\n      let maxCount = 0;\n\n      for (let i = 0; i < tipsByID.length; i++) {\n        if (typeof typeArray[tipsByID[i].hit_set_id] == \"undefined\") {\n          typeArray[tipsByID[i].hit_set_id] = 1;\n        } else {\n          typeArray[tipsByID[i].hit_set_id]++;\n        }\n\n        if (typeArray[tipsByID[i].hit_set_id] > maxCount) {\n          type = tipsByID[i].hit_type;\n          maxCount = typeArray[tipsByID[i].hit_set_id];\n        }\n      }\n\n      return type;\n    } else {\n      //Todo: use machine learning\n      if (title.includes(\"media\")) {\n        return \"audio\";\n      } else if (title.includes(\"data\")) {\n        return \"data\";\n      } else if (title.includes(\"website\")) {\n        return \"data\";\n      } else if (title.includes(\"webpage\")) {\n        return \"data\";\n      } else if (title.includes(\"receipt\")) {\n        return \"imgtrans\";\n      } else if (title.includes(\"survey\")) {\n        return \"survey\";\n      } else if (title.includes(\"tag\")) {\n        return \"imgtag\";\n      } else if (title.includes(\"Categorization\")) {\n        return \"categorize\";\n      } else if (title.includes(\"categorize\")) {\n        return \"categorize\";\n      } else if (title.includes(\"category\")) {\n        return \"categorize\";\n      } else if (title.includes(\"class\")) {\n        return \"categorize\";\n      } else if (title.includes(\"collect\")) {\n        return \"categorize\";\n      } else if (title.includes(\"label\")) {\n        return \"imgtag\";\n      } else if (title.includes(\"article\")) {\n        return \"write\";\n      } else if (title.includes(\"write\")) {\n        return \"write\";\n      } else if (title.includes(\"writing\")) {\n        return \"write\";\n      } else if (title.includes(\"indicate\")) {\n        return \"survey\";\n      } else if (title.includes(\"postcard\")) {\n        return \"imgtrans\";\n      } else if (title.includes(\"contact\")) {\n        return \"data\";\n      } else if (title.includes(\"match\")) {\n        return \"categorize\";\n      } else if (title.includes(\"clean\")) {\n        return \"write\";\n      } else if (title.includes(\"video\")) {\n        return \"audio\";\n      } else if (title.includes(\"audio\")) {\n        return \"audio\";\n      } else if (title.includes(\"coin\")) {\n        return \"imgtag\";\n      } else if (title.includes(\"company\")) {\n        return \"data\";\n      } else if (title.includes(\"predict\")) {\n        return \"survey\";\n      } else if (title.includes(\"study\")) {\n        return \"survey\";\n      } else if (title.includes(\"questionnaire\")) {\n        return \"survey\";\n      } else if (title.includes(\"second\")) {\n        return \"audio\";\n      } else if (title.includes(\"transcribe\")) {\n        return \"imgtrans\";\n      } else if (title.includes(\"speech\")) {\n        return \"audio\";\n      } else if (title.includes(\"draw\")) {\n        return \"imgtag\";\n      } else if (title.includes(\"yourself\")) {\n        return \"survey\";\n      } else if (title.includes(\"official\")) {\n        return \"data\";\n      }\n\n      return \"others\";\n    }\n  }\n\n  function getTopTip(tipArray, getCount) {\n    let retrunTips = [];\n\n    if (tipArray.length > 0) {\n      tipArray.sort(function (a, b) {\n        return b.score - a.score;\n      }); // console.log(tipArray);\n\n      let tmpTips = []; //Handle the tips which has the same score \n\n      let prvScore = -1; //The plugin do not display the tips which score is lower than -3\n\n      let prvIndex = -1;\n\n      for (let i = 0; i < tipArray.length; i++) {\n        if (tipArray[i].score != prvScore) {\n          //Have enough tips to display\n          if (tmpTips.length != 0) {\n            if (tmpTips.length < getCount - retrunTips.length) {\n              let tmpLength = tmpTips.length;\n\n              for (let j = 0; j < tmpLength; j++) {\n                retrunTips.push(tmpTips.pop());\n              }\n            } else {\n              //Do not have enough space to display\n              tmpTips = shuffle(tmpTips);\n\n              for (let j = 0; j < MAXTOPTIP - retrunTips.length; j++) {\n                retrunTips.push(tmpTips.pop());\n              }\n            }\n\n            if (retrunTips.length >= getCount) {\n              break;\n            }\n          }\n\n          prvScore = tipArray[i].score;\n          prvIndex = i;\n          tmpTips.push(tipArray[i]);\n        } else {\n          tmpTips.push(tipArray[i]);\n        }\n\n        if (tmpTips.length < getCount - retrunTips.length) {\n          let tmpLength = tmpTips.length;\n\n          for (let j = 0; j < tmpLength; j++) {\n            retrunTips.push(tmpTips.pop());\n          }\n        } else {\n          //Do not have enough space to display\n          tmpTips = shuffle(tmpTips);\n\n          for (let j = 0; j < getCount - retrunTips.length; j++) {\n            retrunTips.push(tmpTips.pop());\n          }\n        }\n      }\n\n      return retrunTips;\n    } else {\n      //Todo: error message\n      console.log(\"There are no tips for the same hit id\");\n      return retrunTips;\n    }\n  }\n\n  Meteor.methods({\n    storeTip: function (requestBody) {\n      Tips.insert({\n        provider_id: requestBody.providerID,\n        hit_set_id: requestBody.hitSetID,\n        hit_type: requestBody.hitType,\n        tip: requestBody.content,\n        score: 0\n      }); //console.log(\"Success store raw tips to database\");\n    },\n    storeRawType: function (requestBody) {\n      //Todo: think whether require to store the raw tips info\n      HTType.insert({\n        hit_set_id: requestBody.hitSetID,\n        hit_raw_type: requestBody.hitType,\n        worker_id: requestBody.providerID\n      });\n    },\n    provideTip: function (requestBody) {\n      Tips.insert({\n        provider_id: requestBody.providerID,\n        hit_set_id: requestBody.hitSetID,\n        hit_type: requestBody.hitType,\n        tip: requestBody.content,\n        score: 0,\n        create_timestamp: requestBody.create_timestamp\n      });\n      console.log(\"Success store raw tips to database\");\n    },\n    getTip: function (requestBody) {\n      let topTips = []; //Same ID\n\n      let tipsByID = Tips.find({\n        hit_set_id: requestBody.hitSetID\n      }).fetch();\n\n      if (tipsByID.length > 0) {\n        let topTipsByID = getTopTip(tipsByID, MAXTOPTIP);\n        topTips.push.apply(topTips, topTipsByID);\n      } //Same type top\n\n\n      let hitType = guessHITType(requestBody.hitSetID, requestBody.hitTitle.toLowerCase(), requestBody.hitDesc.toLowerCase(), requestBody.requesterID);\n      let tipsByType = Tips.find({\n        hit_type: hitType,\n        hit_set_id: {\n          $ne: requestBody.hitSetID\n        }\n      }).fetch();\n\n      if (tipsByType.length > 0) {\n        let topTipsByType = getTopTip(tipsByType, MAXTYPETOPTIP - topTips.length);\n        topTips.push.apply(topTips, topTipsByType);\n      } //Same type \n\n\n      let tipsByTypeID = Tips.find({\n        hit_type: hitType\n      }).fetch();\n      tipsByType = shuffle(tipsByType);\n\n      for (let i = tipsByType.length - 1; i >= 0; i--) {\n        let isAlreadyIn = false;\n\n        if (tipsByType[i].score > -3) {\n          for (let j = 0; j < topTips.length; j++) {\n            if (tipsByType[i]._id == topTips[j]._id) {\n              isAlreadyIn = true;\n              break;\n            }\n          }\n\n          if (!isAlreadyIn) {\n            topTips.push(tipsByType.pop());\n            break;\n          }\n        }\n      }\n\n      if (topTips.length > 0) {\n        return JSON.stringify(topTips);\n      } else {\n        return \"\";\n      }\n    },\n    \"getFeedback\": function (requestBody) {\n      let feedback = Feedback.find({\n        tip_id: requestBody.tip_id,\n        feedbacker_id: requestBody.feedbacker_id\n      }).fetch();\n\n      if (feedback.length == 0) {\n        return '{\"score\":0}';\n      } else {\n        return '{\"score\":' + feedback[0].score + '}';\n      }\n    },\n    \"upvoteTip\": function (requestBody) {\n      let feedback = Feedback.find({\n        tip_id: requestBody.tip_id,\n        feedbacker_id: requestBody.feedbacker_id\n      }).fetch();\n      let tip = Tips.find({\n        _id: requestBody.tip_id\n      }).fetch()[0];\n\n      if (feedback.length == 0) {\n        //the user hasn't provide feedback to the hit.\n        Feedback.insert({\n          feedbacker_id: requestBody.feedbacker_id,\n          tip_id: requestBody.tip_id,\n          score: 1,\n          create_timestamp: requestBody.create_timestamp\n        });\n        let tipScore = tip.score + 1;\n        Tips.update({\n          _id: requestBody.tip_id\n        }, {\n          $set: {\n            score: tipScore\n          }\n        });\n        return '{\"score\":1}';\n      } else {\n        if (feedback[0].score == 1) {\n          Feedback.update({\n            tip_id: requestBody.tip_id,\n            feedbacker_id: requestBody.feedbacker_id\n          }, {\n            $set: {\n              score: 0\n            }\n          });\n          let tipScore = tip.score - 1;\n          Tips.update({\n            _id: requestBody.tip_id\n          }, {\n            $set: {\n              score: tipScore\n            }\n          });\n          return '{\"score\":0}';\n        } else if (feedback[0].score == 0) {\n          Feedback.update({\n            tip_id: requestBody.tip_id,\n            feedbacker_id: requestBody.feedbacker_id\n          }, {\n            $set: {\n              score: 1\n            }\n          });\n          let tipScore = tip.score + 1;\n          Tips.update({\n            _id: requestBody.tip_id\n          }, {\n            $set: {\n              score: tipScore\n            }\n          });\n          return '{\"score\":1}';\n        } else if (feedback[0].score == -1) {\n          Feedback.update({\n            tip_id: requestBody.tip_id,\n            feedbacker_id: requestBody.feedbacker_id\n          }, {\n            $set: {\n              score: 1\n            }\n          });\n          let tipScore = tip.score + 2;\n          Tips.update({\n            _id: requestBody.tip_id\n          }, {\n            $set: {\n              score: tipScore\n            }\n          });\n          return '{\"score\":1}';\n        }\n      }\n    },\n    \"downvoteTip\": function (requestBody) {\n      let feedback = Feedback.find({\n        tip_id: requestBody.tip_id,\n        feedbacker_id: requestBody.feedbacker_id\n      }).fetch();\n      let tip = Tips.find({\n        _id: requestBody.tip_id\n      }).fetch()[0];\n\n      if (feedback.length == 0) {\n        //the user hasn't provide feedback to the hit.\n        Feedback.insert({\n          feedbacker_id: requestBody.feedbacker_id,\n          tip_id: requestBody.tip_id,\n          score: -1,\n          create_timestamp: requestBody.create_timestamp\n        });\n        let tipScore = tip.score - 1;\n        Tips.update({\n          _id: requestBody.tip_id\n        }, {\n          $set: {\n            score: tipScore\n          }\n        });\n        return '{\"score\":-1}';\n      } else {\n        if (feedback[0].score == 1) {\n          Feedback.update({\n            tip_id: requestBody.tip_id,\n            feedbacker_id: requestBody.feedbacker_id\n          }, {\n            $set: {\n              score: -1\n            }\n          });\n          let tipScore = tip.score - 2;\n          Tips.update({\n            _id: requestBody.tip_id\n          }, {\n            $set: {\n              score: tipScore\n            }\n          });\n          return '{\"score\":-1}';\n        } else if (feedback[0].score == 0) {\n          Feedback.update({\n            tip_id: requestBody.tip_id,\n            feedbacker_id: requestBody.feedbacker_id\n          }, {\n            $set: {\n              score: -1\n            }\n          });\n          let tipScore = tip.score - 1;\n          Tips.update({\n            _id: requestBody.tip_id\n          }, {\n            $set: {\n              score: tipScore\n            }\n          });\n          return '{\"score\":-1}';\n        } else if (feedback[0].score == -1) {\n          Feedback.update({\n            tip_id: requestBody.tip_id,\n            feedbacker_id: requestBody.feedbacker_id\n          }, {\n            $set: {\n              score: 0\n            }\n          });\n          let tipScore = tip.score + 1;\n          Tips.update({\n            _id: requestBody.tip_id\n          }, {\n            $set: {\n              score: tipScore\n            }\n          });\n          return '{\"score\":0}';\n        }\n      }\n    }\n  });\n});","map":{"version":3,"sources":["server/main.js"],"names":["Meteor","module","watch","require","v","startup","MAXTOPTIP","MAXNEWTIP","MAXTYPETOPTIP","shuffle","tmparray","currentIndex","length","temporaryValue","randomIndex","Math","floor","random","guessHITType","id","title","description","requester","tipsByID","Tips","find","hit_set_id","fetch","type","typeArray","maxCount","i","hit_type","includes","getTopTip","tipArray","getCount","retrunTips","sort","a","b","score","tmpTips","prvScore","prvIndex","tmpLength","j","push","pop","console","log","methods","storeTip","requestBody","insert","provider_id","providerID","hitSetID","hitType","tip","content","storeRawType","HTType","hit_raw_type","worker_id","provideTip","create_timestamp","getTip","topTips","topTipsByID","apply","hitTitle","toLowerCase","hitDesc","requesterID","tipsByType","$ne","topTipsByType","tipsByTypeID","isAlreadyIn","_id","JSON","stringify","feedback","Feedback","tip_id","feedbacker_id","tipScore","update","$set"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport \"./dataScheme.js\";\n\nMeteor.startup(() => {\n\tconst MAXTOPTIP = 2;\n\tconst MAXNEWTIP = 1;\n\tconst MAXTYPETOPTIP = 3;\n\n\n\tfunction shuffle(tmparray) {\n\t\tlet currentIndex = tmparray.length, temporaryValue, randomIndex;\n\n\t\t// While there remain elements to shuffle...\n\t\twhile (0 !== currentIndex) {\n\n\t\t// Pick a remaining element...\n\t\trandomIndex = Math.floor(Math.random() * currentIndex);\n\t\tcurrentIndex -= 1;\n\n\t\t// And swap it with the current element.\n\t\ttemporaryValue = tmparray[currentIndex];\n\t\ttmparray[currentIndex] = tmparray[randomIndex];\n\t\ttmparray[randomIndex] = temporaryValue;\n\t\t}\n\treturn tmparray;\n\t}\n\n\tfunction guessHITType(id ,title, description, requester){\n\n\t\tlet tipsByID = Tips.find({hit_set_id: id}).fetch();\n\t\tlet type = \"\";\n\t\tlet typeArray = [];\n\t\tif(tipsByID.length > 0){\n\t\t\tlet maxCount = 0;\n\t\t\tfor(let i = 0; i < tipsByID.length; i++){\n\t\t\t\tif (typeof typeArray[tipsByID[i].hit_set_id] == \"undefined\"){\n\t\t\t\t\ttypeArray[tipsByID[i].hit_set_id] = 1;\n\t\t\t\t}else{\n\t\t\t\t\ttypeArray[tipsByID[i].hit_set_id]++;\n\t\t\t\t}\n\t\t\t\tif(typeArray[tipsByID[i].hit_set_id] > maxCount){\n\t\t\t\t\ttype = tipsByID[i].hit_type;\n\t\t\t\t\tmaxCount = typeArray[tipsByID[i].hit_set_id];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn type;\n\t\t}else{\n\t\t\t//Todo: use machine learning\n\t\t\tif(title.includes(\"media\")){\n\t\t\t\treturn \"audio\";\n\t\t\t}else if(title.includes(\"data\")){\n\t\t\t\treturn \"data\";\n\t\t\t}else if(title.includes(\"website\")){\n\t\t\t\treturn \"data\";\n\t\t\t}else if(title.includes(\"webpage\")){\n\t\t\t\treturn \"data\";\n\t\t\t}else if(title.includes(\"receipt\")){\n\t\t\t\treturn \"imgtrans\";\n\t\t\t}else if(title.includes(\"survey\")){\n\t\t\t\treturn \"survey\";\n\t\t\t}else if(title.includes(\"tag\")){\n\t\t\t\treturn \"imgtag\";\n\t\t\t}else if(title.includes(\"Categorization\")){\n\t\t\t\treturn \"categorize\";\n\t\t\t}else if(title.includes(\"categorize\")){\n\t\t\t\treturn \"categorize\";\n\t\t\t}else if(title.includes(\"category\")){\n\t\t\t\treturn \"categorize\";\n\t\t\t}else if(title.includes(\"class\")){\n\t\t\t\treturn \"categorize\";\n\t\t\t}else if(title.includes(\"collect\")){\n\t\t\t\treturn \"categorize\";\n\t\t\t}else if(title.includes(\"label\")){\n\t\t\t\treturn \"imgtag\";\n\t\t\t}else if(title.includes(\"article\")){\n\t\t\t\treturn \"write\";\n\t\t\t}else if(title.includes(\"write\")){\n\t\t\t\treturn \"write\";\n\t\t\t}else if(title.includes(\"writing\")){\n\t\t\t\treturn \"write\";\n\t\t\t}else if(title.includes(\"indicate\")){\n\t\t\t\treturn \"survey\";\n\t\t\t}else if(title.includes(\"postcard\")){\n\t\t\t\treturn \"imgtrans\";\n\t\t\t}else if(title.includes(\"contact\")){\n\t\t\t\treturn \"data\";\n\t\t\t}else if(title.includes(\"match\")){\n\t\t\t\treturn \"categorize\";\n\t\t\t}else if(title.includes(\"clean\")){\n\t\t\t\treturn \"write\";\n\t\t\t}else if(title.includes(\"video\")){\n\t\t\t\treturn \"audio\";\n\t\t\t}else if(title.includes(\"audio\")){\n\t\t\t\treturn \"audio\";\n\t\t\t}else if(title.includes(\"coin\")){\n\t\t\t\treturn \"imgtag\";\n\t\t\t}else if(title.includes(\"company\")){\n\t\t\t\treturn \"data\";\n\t\t\t}else if(title.includes(\"predict\")){\n\t\t\t\treturn \"survey\";\n\t\t\t}else if(title.includes(\"study\")){\n\t\t\t\treturn \"survey\";\n\t\t\t}else if(title.includes(\"questionnaire\")){\n\t\t\t\treturn \"survey\";\n\t\t\t}else if(title.includes(\"second\")){\n\t\t\t\treturn \"audio\";\n\t\t\t}else if(title.includes(\"transcribe\")){\n\t\t\t\treturn \"imgtrans\";\n\t\t\t}else if(title.includes(\"speech\")){\n\t\t\t\treturn \"audio\";\n\t\t\t}else if(title.includes(\"draw\")){\n\t\t\t\treturn \"imgtag\";\n\t\t\t}else if(title.includes(\"yourself\")){\n\t\t\t\treturn \"survey\";\n\t\t\t}else if(title.includes(\"official\")){\n\t\t\t\treturn \"data\";\n\t\t\t}\n\t\t\treturn \"others\";\n\t\t}\n\t}\n\t\t\n\tfunction getTopTip(tipArray, getCount){\n\t\tlet retrunTips = [];\n\t\tif(tipArray.length > 0){\n\t\t\t\ttipArray.sort(function(a,b){return b.score - a.score});\n\t\t\t\t// console.log(tipArray);\n\t\t\t\tlet tmpTips = []; //Handle the tips which has the same score \n\t\t\t\tlet prvScore = -1; //The plugin do not display the tips which score is lower than -3\n\t\t\t\tlet prvIndex = -1;\n\t\t\t\tfor(let i = 0 ; i < tipArray.length; i++){\n\t\t\t\t\tif(tipArray[i].score != prvScore){\n\t\t\t\t\t\t//Have enough tips to display\n\t\t\t\t\t\tif(tmpTips.length != 0){\n\t\t\t\t\t\t\tif(tmpTips.length < getCount - retrunTips.length ){\n\t\t\t\t\t\t\t\tlet tmpLength = tmpTips.length;\n\t\t\t\t\t\t\t\tfor(let j = 0; j < tmpLength; j++){\n\t\t\t\t\t\t\t\t\tretrunTips.push(tmpTips.pop());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}else{ //Do not have enough space to display\n\t\t\t\t\t\t\t\ttmpTips = shuffle(tmpTips);\n\t\t\t\t\t\t\t\tfor (let j = 0; j < MAXTOPTIP - retrunTips.length; j++){\n\t\t\t\t\t\t\t\t\tretrunTips.push(tmpTips.pop());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(retrunTips.length >= getCount){\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tprvScore = tipArray[i].score;\n\t\t\t\t\t\tprvIndex = i;\n\t\t\t\t\t\ttmpTips.push(tipArray[i]);\n\t\t\t\t\t\t\n\t\t\t\t\t}else{\n\t\t\t\t\t\ttmpTips.push(tipArray[i]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif(tmpTips.length < getCount - retrunTips.length ){\n\t\t\t\t\t\tlet tmpLength = tmpTips.length;\n\t\t\t\t\t\tfor(let j = 0; j < tmpLength; j++){\n\t\t\t\t\t\t\tretrunTips.push(tmpTips.pop());\n\t\t\t\t\t\t}\n\t\t\t\t\t}else{ //Do not have enough space to display\n\t\t\t\t\t\ttmpTips = shuffle(tmpTips);\n\t\t\t\t\t\tfor (let j = 0; j < getCount - retrunTips.length; j++){\n\t\t\t\t\t\t\tretrunTips.push(tmpTips.pop());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\treturn retrunTips;\n\t\t\t}else{\n\t\t\t\t//Todo: error message\n\t\t\t\tconsole.log(\"There are no tips for the same hit id\");\n\t\t\t\treturn retrunTips;\n\t\t\t}\n\n\t}\n\n\n\tMeteor.methods({\n\t\tstoreTip: function(requestBody){\n\t\t\tTips.insert({\n\t\t\t\tprovider_id: requestBody.providerID,\n\t\t\t\thit_set_id: requestBody.hitSetID,\n\t\t\t\thit_type : requestBody.hitType,\n\t\t\t\ttip: requestBody.content,\n\t\t\t\tscore: 0\n\t\t\t});\n\t\t\t//console.log(\"Success store raw tips to database\");\n\t\t},\n\t\tstoreRawType: function(requestBody){\n\t\t\t//Todo: think whether require to store the raw tips info\n\t\t\tHTType.insert({\n\t\t\t\thit_set_id: requestBody.hitSetID,\n\t\t\t\thit_raw_type: requestBody.hitType,\n\t\t\t\tworker_id: requestBody.providerID\n\t\t\t});\n\t\t},\n\t\tprovideTip: function(requestBody){\n\t\t\tTips.insert({\n\t\t\t\tprovider_id: requestBody.providerID,\n\t\t\t\thit_set_id: requestBody.hitSetID,\n\t\t\t\thit_type : requestBody.hitType,\n\t\t\t\ttip: requestBody.content,\n\t\t\t\tscore: 0,\n\t\t\t\tcreate_timestamp: requestBody.create_timestamp\n\t\t\t});\n\t\t\tconsole.log(\"Success store raw tips to database\");\n\t\t\t\n\t\t},\n\t\tgetTip: function(requestBody){\n\t\t\tlet topTips = [];\n\n\t\t\t//Same ID\n\t\t\tlet tipsByID = Tips.find({hit_set_id: requestBody.hitSetID}).fetch();\n\t\t\tif(tipsByID.length > 0){\n\t\t\t\tlet topTipsByID = getTopTip(tipsByID, MAXTOPTIP);\n\t\t\t\ttopTips.push.apply(topTips, topTipsByID);\n\t\t\t}\n\t\t\t\n\t\t\t//Same type top\n\t\t\tlet hitType = guessHITType(requestBody.hitSetID, requestBody.hitTitle.toLowerCase(), requestBody.hitDesc.toLowerCase(), requestBody.requesterID);\n\t\t\tlet tipsByType = Tips.find({hit_type: hitType, hit_set_id: {$ne: requestBody.hitSetID}}).fetch();\n\t\t\tif(tipsByType.length > 0){\n\t\t\t\tlet topTipsByType = getTopTip(tipsByType, MAXTYPETOPTIP-topTips.length);\n\t\t\t\ttopTips.push.apply(topTips, topTipsByType);\n\t\t\t}\n\n\t\t\t//Same type \n\t\t\tlet tipsByTypeID = Tips.find({hit_type: hitType}).fetch();\n\t\t\ttipsByType = shuffle(tipsByType);\n\t\t\tfor(let i = tipsByType.length-1; i >= 0 ; i--){\n\t\t\t\tlet isAlreadyIn = false;\n\t\t\t\tif(tipsByType[i].score > -3 ){\n\t\t\t\t\tfor(let j = 0 ; j < topTips.length; j++){\n\t\t\t\t\t\tif(tipsByType[i]._id == topTips[j]._id){\n\t\t\t\t\t\t\tisAlreadyIn = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(!isAlreadyIn){\n\t\t\t\t\t\ttopTips.push(tipsByType.pop());\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\tif(topTips.length > 0){\n\t\t\t\treturn JSON.stringify(topTips);\n\t\t\t}else{\n\t\t\t\treturn \"\";\n\t\t\t}\n\n\t\t\t\n\t\t},\n\t\t\"getFeedback\": function(requestBody){\n\t\t\tlet feedback = Feedback.find({tip_id: requestBody.tip_id, feedbacker_id: requestBody.feedbacker_id}).fetch();\n\t\t\tif(feedback.length == 0){\n\t\t\t\treturn '{\"score\":0}';\n\t\t\t} else {\n\t\t\t\treturn '{\"score\":'+feedback[0].score+'}';\n\t\t\t}\n\t\t},\n\t\t\"upvoteTip\": function(requestBody){\n\t\t\tlet feedback = Feedback.find({tip_id: requestBody.tip_id, feedbacker_id: requestBody.feedbacker_id}).fetch();\n\t\t\tlet tip = Tips.find({_id: requestBody.tip_id}).fetch()[0];\n\t\t\tif(feedback.length == 0){ //the user hasn't provide feedback to the hit.\n\t\t\t\tFeedback.insert({\n\t\t\t\t\tfeedbacker_id: requestBody.feedbacker_id,\n\t\t\t\t\ttip_id: requestBody.tip_id,\n\t\t\t\t\tscore: 1,\n\t\t\t\t\tcreate_timestamp: requestBody.create_timestamp\n\t\t\t\t});\n\t\t\t\tlet tipScore = tip.score + 1;\n\t\t\t\tTips.update({_id: requestBody.tip_id}, {$set: {score: tipScore}});\n\t\t\t\treturn '{\"score\":1}';\n\t\t\t}else{\n\t\t\t\tif(feedback[0].score == 1){\n\t\t\t\t\tFeedback.update({tip_id: requestBody.tip_id, feedbacker_id: requestBody.feedbacker_id}, {$set: {score: 0}});\n\t\t\t\t\tlet tipScore = tip.score - 1;\n\t\t\t\t\tTips.update({_id: requestBody.tip_id}, {$set: {score: tipScore}});\n\t\t\t\t\treturn '{\"score\":0}';\n\t\t\t\t}else if(feedback[0].score == 0){\n\t\t\t\t\tFeedback.update({tip_id: requestBody.tip_id, feedbacker_id: requestBody.feedbacker_id}, {$set: {score: 1}});\n\t\t\t\t\tlet tipScore = tip.score + 1;\n\t\t\t\t\tTips.update({_id: requestBody.tip_id}, {$set: {score: tipScore}});\n\t\t\t\t\treturn '{\"score\":1}';\n\t\t\t\t}else if(feedback[0].score == -1){\n\t\t\t\t\tFeedback.update({tip_id: requestBody.tip_id, feedbacker_id: requestBody.feedbacker_id}, {$set: {score: 1}});\n\t\t\t\t\tlet tipScore = tip.score + 2;\n\t\t\t\t\tTips.update({_id: requestBody.tip_id}, {$set: {score: tipScore}});\n\t\t\t\t\treturn '{\"score\":1}';\n\t\t\t\t}\n\t\t\t}\n\n\t\t},\n\t\t\"downvoteTip\": function(requestBody){\n\t\t\tlet feedback = Feedback.find({tip_id: requestBody.tip_id, feedbacker_id: requestBody.feedbacker_id}).fetch();\n\t\t\tlet tip = Tips.find({_id: requestBody.tip_id}).fetch()[0];\n\t\t\tif(feedback.length == 0){ //the user hasn't provide feedback to the hit.\n\t\t\t\tFeedback.insert({\n\t\t\t\t\tfeedbacker_id: requestBody.feedbacker_id,\n\t\t\t\t\ttip_id: requestBody.tip_id,\n\t\t\t\t\tscore: -1,\n\t\t\t\t\tcreate_timestamp: requestBody.create_timestamp\n\t\t\t\t});\n\t\t\t\tlet tipScore = tip.score - 1;\n\t\t\t\tTips.update({_id: requestBody.tip_id}, {$set: {score: tipScore}});\n\t\t\t\treturn '{\"score\":-1}';\n\t\t\t}else{\n\t\t\t\tif(feedback[0].score == 1){\n\t\t\t\t\tFeedback.update({tip_id: requestBody.tip_id, feedbacker_id: requestBody.feedbacker_id}, {$set: {score: -1}});\n\t\t\t\t\tlet tipScore = tip.score - 2;\n\t\t\t\t\tTips.update({_id: requestBody.tip_id}, {$set: {score: tipScore}});\n\t\t\t\t\treturn '{\"score\":-1}';\n\t\t\t\t}else if(feedback[0].score == 0){\n\t\t\t\t\tFeedback.update({tip_id: requestBody.tip_id, feedbacker_id: requestBody.feedbacker_id}, {$set: {score: -1}});\n\t\t\t\t\tlet tipScore = tip.score - 1;\n\t\t\t\t\tTips.update({_id: requestBody.tip_id}, {$set: {score: tipScore}});\n\t\t\t\t\treturn '{\"score\":-1}';\n\t\t\t\t}else if(feedback[0].score == -1){\n\t\t\t\t\tFeedback.update({tip_id: requestBody.tip_id, feedbacker_id: requestBody.feedbacker_id}, {$set: {score: 0}});\n\t\t\t\t\tlet tipScore = tip.score + 1;\n\t\t\t\t\tTips.update({_id: requestBody.tip_id}, {$set: {score: tipScore}});\n\t\t\t\t\treturn '{\"score\":0}';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n});\n"]},"sourceType":"script","hash":"e004689187bfe2252415205b3f5d4293e4b24ae9"}
